# ==============================================
# AWS Amplify Build Configuration (monorepo)
# Frontend: Vite -> dist
# Backend: Express/TypeScript server on Node 20
# ==============================================

version: 1
applications:
  # ---------- FRONTEND ----------
  - appRoot: frontend/Front End Soccer Site
    frontend:
      phases:
        preBuild:
          commands:
            - npm ci
        build:
          commands:
            - npm run build
      artifacts:
        baseDirectory: dist        # Vite output confirmed
        files:
          - '**/*'
      cache:
        paths:
          - node_modules/**/*
    env:
      variables:
        NODE_ENV: production

  # ---------- BACKEND ----------
  - appRoot: backend
    frontend:
      phases:
        preBuild:
          commands:
            - npm ci
        build:
          commands:
            - npm run build         # compiles TS -> dist
      artifacts:
        files:
          - '**/*'                  # required by schema
      cache:
        paths:
          - node_modules/**/*
    server:
      command: 'npm start'          # must run: node dist/server.js
      framework: 'express'
      path: '/'
      runtime: 'nodejs20.x'
    env:
      variables:
        NODE_ENV: production
